---
layout: post
title: "JWT tokens for authentication for GraphQL server"
date: 2019-11-11 06:00:12 +0000
permalink: /coding/json-web-tokens-in-graphql
category: coding
full_image_url: https://user-images.githubusercontent.com/10452163/68551611-a43d0a00-0406-11ea-963e-6f501b6a13ae.jpg
meta_description: >
  How to build JWT tokens into a GraphQL server for authentication
excerpt_separator: <!--more-->
---

This will be **part one** of two posts looking at using [JSON Web Tokens](https://jwt.io/){:target="\_blank" rel="noopener"} (JWT) for authentication and authorisation. The technology that I will cover to integrate this in is NodeJS Express and Apollo GraphQL server.

It will helpful if you are familiar with Express and GraphQL to fully benefit from this post but you will get the general idea.

First lets cover the basic flow of JWT authentication when a request is made.

<!--more-->

When a request arrives at the server it is intercepted with our custom middleware:

1. If access token exists carry on, else skip authentication check  
1. Validate access token, append user data to request object and continue, else fall back to refresh token
1. Validate refresh token by checking user is in database, generate new tokens, append user data to request and continue with request
1. Each Graphql endpoint will determine what data to show based on the user data appended to the request.
1. Endpoints requiring authentication, they will return an empty if token is not valid  

There are two tokens generated `access-token` and `refresh-token`. The access token has a short expiry of 15 minutes and if still valid we sent that request straight though instead of querying our user table every time. The refresh token has a longer expiry like 7 days and on this request we check the user is still valid in our database which will generate new tokens for the new session.

It's **important** to note that signed tokens can be decoded to see its contents so **don't store sensitive data** inside, however they can also be encrypted. [Learn more about JWT.](https://jwt.io/introduction/){:target="\_blank" rel="noopener"}

## Getting started

I assume you have setup a GraphQL server using Express and Apollo. Here is a list of npm packages to install:

`npm i apollo-server-express jsonwebtoken`

